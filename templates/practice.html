<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Practice Test</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap">
  <link rel="stylesheet" href="{{ url_for('static', filename='practice.css') }}">
</head>
<body>
  <header class="header">
    <span class="test-title">Test: 2025 example questions Part 1</span>
    <div class="progress"><div class="bar" style="width:0%"></div></div>
    <div class="header-right">
      <button class="finish-btn">Finish Test</button>
      <span class="candidate">Candidate Name</span>
    </div>
  </header>

  <div class="main">
    <aside class="sidebar">
      <ul class="nav"></ul>
    </aside>

    <section class="question-area">
      <p class="scenario"></p>
      <div class="options"></div>
      <div class="calculator" style="display:none">
        <span class="icon">&#128425;</span>
        <label>Answer</label>
        <input type="number">
        <span class="unit"></span>
      </div>
      <button class="check-btn">Check</button>
      <div class="feedback"></div>
    </section>
  </div>

  <footer class="footer">
    <span class="settings">&#9881;</span>
    <button class="close-btn">Close all open tools</button>
    <div class="nav-btns">
      <button class="back-btn">Back</button>
      <button class="next-btn">Next ‚ùØ</button>
    </div>
  </footer>

  <script>
    const questions = {{ questions|tojson|safe }};
    let index = 0;
    let selected = null;

    function initNav() {
      const nav = document.querySelector('.nav');
      nav.textContent = '';
      questions.forEach((q,i) => {
        const li = document.createElement('li');
        li.textContent = i+1;
        if(i===0) li.classList.add('active');
        li.onclick = () => { index = i; renderQuestion(); };
        nav.appendChild(li);
      });
    }

    function updateProgress() {
      const pct = ((index + 1) / questions.length) * 100;
      document.querySelector('.bar').style.width = pct + '%';
    }

    function updateNav() {
      document.querySelectorAll('.nav li').forEach((li,i) => {
        li.classList.toggle('active', i === index);
      });
    }

    function renderQuestion() {
      const q = questions[index];
      selected = null;
      document.querySelector('.scenario').textContent = q.text || q.title || '';
      const opts = document.querySelector('.options');
      const calc = document.querySelector('.calculator');
      const input = calc.querySelector('input');
      const unit = calc.querySelector('.unit');
      const feedback = document.querySelector('.feedback');
      feedback.textContent = '';
      feedback.className = 'feedback';
      opts.textContent = '';
      if(q.answers && q.answers.length){
        calc.style.display = 'none';
        q.answers.forEach(a => {
          const btn = document.createElement('button');
          btn.textContent = a.text;
          btn.onclick = () => {
            opts.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selected = a.answer_number;
          };
          opts.appendChild(btn);
        });
      } else {
        calc.style.display = 'block';
        input.value = '';
        unit.textContent = q.answer_unit || '';
      }
      updateProgress();
      updateNav();
    }

    function updateStats(id, correct) {
      const data = JSON.parse(localStorage.getItem('questionStats') || '{}');
      if (!data[id]) data[id] = {right:0, wrong:0, saved:false};
      if (correct) data[id].right++; else data[id].wrong++;
      localStorage.setItem('questionStats', JSON.stringify(data));
    }

    document.querySelector('.next-btn').onclick = () => {
      if(index < questions.length - 1){ index++; renderQuestion(); }
    };
    document.querySelector('.back-btn').onclick = () => {
      if(index > 0){ index--; renderQuestion(); }
    };

    document.querySelector('.check-btn').onclick = () => {
      const q = questions[index];
      const calc = document.querySelector('.calculator');
      const input = calc.querySelector('input');
      let correct = false;
      if(q.answers && q.answers.length){
        correct = selected == q.correct_answer_number;
      } else {
        const value = input.value.trim();
        correct = value === (q.correct_answer || '');
      }
      const fb = document.querySelector('.feedback');
      fb.textContent = correct ? 'Correct!' : 'Incorrect';
      fb.className = 'feedback ' + (correct ? 'correct' : 'incorrect');
      updateStats(q.id, correct);
    };

    document.addEventListener('DOMContentLoaded', () => {
      if(!questions.length) return;
      initNav();
      renderQuestion();
    });
  </script>
</body>
</html>
