System.register(["./history-legacy-D--lc3Kv.js","./summary-legacy-Bgc9NEes.js"],function(e,t){"use strict";var s,n,i,o,l;return{setters:[e=>{s=e.e,n=e.g,i=e.f,o=e.E,l=e.q},null],execute:function(){window.evaluateAnswer=s,window.getCorrectAnswerText=n,window.formatExplanation=i,new class{testResult=null;currentReviewQuestion=0;reviewMode="all";filteredRows=[];constructor(){this.init(),this.setupBackButtonHandling()}init(){this.loadTestResult(),this.setupEventListeners()}loadTestResult(){const e=new URLSearchParams(window.location.search).get("resultId");if(!e)return alert("No test result found"),void(window.location.href="index.html");try{const t=localStorage.getItem("practice_history"),s=(t?JSON.parse(t):{...o}).results.find(t=>t.id===e);if(!s)return alert("Test result not found"),void(window.location.href="index.html");this.testResult=s,this.populateSummary()}catch(t){console.error("Failed to load test result:",t),alert("Failed to load test result"),window.location.href="index.html"}}populateSummary(){if(!this.testResult)return;const e=document.querySelector(".summary-table tbody"),t=document.getElementById("scoreText");if(!e)return;let i=0;e.innerHTML="",this.filteredRows=[];for(let l=0;l<this.testResult.questions.length;l++){const t=this.testResult.questions[l],o=this.testResult.answers[l]||"No answer",r="No answer"!==o&&s(t,o);r&&i++;const d=e.insertRow();this.filteredRows.push(d);const u=r?"correct":"incorrect",c=r?"✓ Correct":"✗ Incorrect";let a=o;if("No answer"!==o&&!t.is_calculation){const e=t.answers.find(e=>e.answer_number.toString()===o);a=e?e.text:o}d.innerHTML=`\n        <td>\n          <div class="question-number">${l+1}</div>\n        </td>\n        <td class="answer-cell">${a}</td>\n        <td class="correct-answer-cell">${n(t)}</td>\n        <td class="status-cell ${u}">${c}</td>\n        <td class="review-cell">\n          <button class="review-question" data-question="${l}">Review</button>\n        </td>\n      `}const o=Math.round(i/this.testResult.totalQuestions*100);t&&(t.textContent=`You scored ${i}/${this.testResult.totalQuestions} (${o}%)`),e.addEventListener("click",e=>{const t=e.target.closest(".review-question");if(t){const e=parseInt(t.dataset.question||"0");this.openReviewModal(e)}}),this.applyFilters()}setupEventListeners(){const e=document.getElementById("goHomeBtn"),t=document.querySelector(".modal-close"),s=document.getElementById("closeReviewBtn"),n=document.getElementById("prevQuestionBtn"),i=document.getElementById("nextQuestionBtn"),o=document.querySelector(".clear-filter-btn");e&&e.addEventListener("click",()=>{window.location.href="index.html"}),t&&t.addEventListener("click",()=>this.closeReviewModal()),s&&s.addEventListener("click",()=>this.closeReviewModal()),n&&n.addEventListener("click",()=>this.navigateReviewQuestion(-1)),i&&i.addEventListener("click",()=>this.navigateReviewQuestion(1)),o&&o.addEventListener("click",()=>this.clearFilters());const l=document.getElementById("filterCorrect"),r=document.getElementById("filterIncorrect"),d=document.getElementById("filterUnanswered");l&&l.addEventListener("change",()=>this.applyFilters()),r&&r.addEventListener("change",()=>this.applyFilters()),d&&d.addEventListener("change",()=>this.applyFilters());const u=document.getElementById("reviewModal");u&&u.addEventListener("click",e=>{e.target===u&&this.closeReviewModal()})}applyFilters(){const e=document.getElementById("filterCorrect"),t=document.getElementById("filterIncorrect"),n=document.getElementById("filterUnanswered");if(!this.testResult)return;const i=e?.checked||t?.checked||n?.checked;this.filteredRows.forEach((o,l)=>{const r=this.testResult.questions[l],d=this.testResult.answers[l]||"No answer",u="No answer"!==d&&s(r,d);let c=!1;i?(u&&e?.checked||!u&&t?.checked||"No answer"===d&&n?.checked)&&(c=!0):c=!0,o.style.display=c?"":"none"})}clearFilters(){const e=document.getElementById("filterCorrect"),t=document.getElementById("filterIncorrect"),s=document.getElementById("filterUnanswered");e&&(e.checked=!1),t&&(t.checked=!1),s&&(s.checked=!1),this.applyFilters()}startReviewMode(e){if(!this.testResult)return;this.reviewMode=e;let t=0;if("incorrect"===e)for(let n=0;n<this.testResult.questions.length;n++){const e=this.testResult.answers[n];if(e&&!s(this.testResult.questions[n],e)){t=n;break}}else if("flagged"===e)for(let s=0;s<this.testResult.questions.length;s++)if(this.testResult.flagged.includes(s)){t=s;break}this.openReviewModal(t)}openReviewModal(e){if(!this.testResult||e<0||e>=this.testResult.questions.length)return;this.currentReviewQuestion=e;const t=this.testResult.questions[e],s=this.testResult.answers[e]||"No answer",n=document.getElementById("reviewQuestionTitle");n&&(n.textContent=`Question ${e+1} Review`),l&&l.renderQuestion(t,{text:"#reviewQuestionText",title:"#reviewQuestionTitle",img:"#reviewQuestionImage",options:"#reviewAnswerOptions",showInput:!1,reviewMode:!0,userAnswer:s}),l&&l.displayAnswer(t,"reveal"),this.updateReviewNavigation();const i=document.getElementById("reviewModal");i&&(i.style.display="block")}closeReviewModal(){const e=document.getElementById("reviewModal");e&&(e.style.display="none")}updateReviewNavigation(){if(!this.testResult)return;const e=document.getElementById("prevQuestionBtn"),t=document.getElementById("nextQuestionBtn");e&&(e.disabled=0===this.currentReviewQuestion),t&&(t.disabled=this.currentReviewQuestion===this.testResult.questions.length-1)}navigateReviewQuestion(e){if(!this.testResult)return;let t=this.currentReviewQuestion+e;if("incorrect"===this.reviewMode)for(;t>=0&&t<this.testResult.questions.length;){const n=this.testResult.answers[t];if(n&&!s(this.testResult.questions[t],n))break;t+=e}else if("flagged"===this.reviewMode)for(;t>=0&&t<this.testResult.questions.length&&!this.testResult.flagged.includes(t);)t+=e;t>=0&&t<this.testResult.questions.length&&this.openReviewModal(t)}setupBackButtonHandling(){window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",()=>{confirm("Are you sure you want to leave this page? Your test results will be lost.")?window.location.href="index.html":window.history.pushState(null,"",window.location.href)}),window.addEventListener("beforeunload",e=>(e.preventDefault(),e.returnValue="Are you sure you want to leave this page? Your test results will be lost.",e.returnValue))}}}}});
//# sourceMappingURL=summary-legacy-CMWy4BWc.js.map
